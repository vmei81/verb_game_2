<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Matching de Verbos (por Color)</title>
    
    <style>
        :root {
            --color-primary: #3498db;
            --color-secondary: #2ecc71;
            --color-accent: #f39c12;
            --color-bg: #ecf0f1;
            --color-card-bg: #ffffff;
            --color-text: #2c3e50;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        #gameContainer {
            width: 100%;
            max-width: 1200px;
            background-color: var(--color-card-bg);
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }

        h1 {
            color: var(--color-primary);
            margin-top: 0;
            margin-bottom: 5px;
        }

        #progress, #feedback {
            font-size: 1.1rem;
            margin: 10px 0;
            min-height: 25px;
            font-weight: bold;
        }
        
        #feedback.correct {
            color: var(--color-secondary);
        }

        /* --- CONTENEDOR DE JUEGO Y COLUMNAS --- */
        .columns-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
        }

        .column {
            flex: 1;
            min-height: 400px;
            background-color: #f7f9fb;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #bdc3c7;
        }

        .column h2 {
            margin-top: 0;
            font-size: 1.2rem;
            color: var(--color-text);
            border-bottom: 2px solid var(--color-accent);
            padding-bottom: 5px;
        }

        /* --- TARJETAS (CLICKEABLES) --- */
        .verb-card {
            background-color: #e6f3ff;
            color: var(--color-text);
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s, border 0.2s;
            font-weight: 600;
            border: 2px solid transparent;
        }

        .verb-card:hover {
            background-color: #d2e8ff;
        }

        /* Estado Seleccionado */
        .verb-card.selected {
            border-color: var(--color-primary);
            background-color: #c9e4ff;
        }
        
        /* Estado Matcheado */
        .verb-card.matched {
            color: white;
            cursor: default;
            pointer-events: none; /* Desactivar clics en ya completados */
        }
        
        /* Controles y Fin del Juego */
        #controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
        }
        
        #nextRoundBtn, #restartBtn {
            background-color: var(--color-primary);
            color: white;
        }
        
        #nextRoundBtn:hover, #restartBtn:hover {
            background-color: #2980b9;
        }
        
        #exitBtn {
            background-color: #95a5a6;
            color: white;
        }
        
        #exitBtn:hover {
            background-color: #7f8c8d;
        }
        
        #endScreen {
            padding: 40px;
            border: 3px solid var(--color-secondary);
            border-radius: 10px;
            margin-top: 30px;
            display: none;
        }
        
        #endScreen h2 {
            color: var(--color-secondary);
            font-size: 2rem;
        }
        
        /* Media Queries */
        @media (max-width: 768px) {
            .columns-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<div id="gameContainer">
    <h1>Verbos: Presente, Pasado y Participio (Match por Color)</h1>
    <p id="progress">Ronda 1 de 2 | Verbos completados: 0/10</p>
    <div id="feedback">Haz clic en Presente, Pasado y Participio correctos para que se coloreen.</div>

    <div id="endScreen">
        <h2>¡Juego Terminado!</h2>
        <p>Has completado las 2 rondas con éxito.</p>
        <div id="controls">
            <button id="restartBtn" class="btn">Reiniciar Partida</button>
            <button id="exitBtn" class="btn">Salir del Juego</button>
        </div>
    </div>

    <div id="gameArea">
        <div class="columns-container">
            <div class="column" id="colPresente">
                <h2>Presente (Base Form)</h2>
            </div>
            <div class="column" id="colPasado">
                <h2>Pasado (Past Simple)</h2>
            </div>
            <div class="column" id="colParticipio">
                <h2>Pasado Participio (Past Participle)</h2>
            </div>
        </div>
        <div id="controls">
            <button id="nextRoundBtn" class="btn" style="display: none;">Continuar a la Ronda 2</button>
        </div>
    </div>
</div>

<script>
    const VERBS_DATA = [
        { id: 1, p: 'eat', ps: 'ate', pp: 'eaten' },
        { id: 2, p: 'dance', ps: 'danced', pp: 'danced' },
        { id: 3, p: 'paint', ps: 'painted', pp: 'painted' },
        { id: 4, p: 'send', ps: 'sent', pp: 'sent' },
        { id: 5, p: 'plant', ps: 'planted', pp: 'planted' },
        { id: 6, p: 'walk', ps: 'walked', pp: 'walked' },
        { id: 7, p: 'study', ps: 'studied', pp: 'studied' },
        { id: 8, p: 'play', ps: 'played', pp: 'played' },
        { id: 9, p: 'go', ps: 'went', pp: 'gone' },
        { id: 10, p: 'travel', ps: 'traveled', pp: 'traveled' },
        { id: 11, p: 'ask', ps: 'asked', pp: 'asked' },
        { id: 12, p: 'accept', ps: 'accepted', pp: 'accepted' },
        { id: 13, p: 'answer', ps: 'answered', pp: 'answered' },
        { id: 14, p: 'win', ps: 'won', pp: 'won' },
        { id: 15, 'p': 'catch', ps: 'caught', pp: 'caught' },
        { id: 16, p: 'open', ps: 'opened', pp: 'opened' },
        { id: 17, p: 'think about', ps: 'thought about', pp: 'thought about' },
        { id: 18, p: 'wash', ps: 'washed', pp: 'washed' },
        { id: 19, p: 'show', ps: 'showed', pp: 'shown' },
        { id: 20, p: 'give', ps: 'gave', pp: 'given' }
    ];

    // Paleta de colores distintivos (se usarán los primeros 10 en cada ronda)
    const COLOR_PALETTE = [
        '#e74c3c', // Rojo
        '#9b59b6', // Púrpura
        '#1abc9c', // Turquesa
        '#f39c12', // Naranja
        '#3498db', // Azul (Primary)
        '#c0392b', // Rojo oscuro
        '#27ae60', // Verde oscuro
        '#2980b9', // Azul oscuro
        '#8e44ad', // Morado oscuro
        '#d35400'  // Calabaza
    ];

    // --- VARIABLES DE ESTADO ---
    let currentRound = 0;
    let matchedCount = 0;
    const verbsPerRound = 10;
    let selectedCards = []; // Almacena hasta 3 tarjetas seleccionadas

    // --- ELEMENTOS DEL DOM ---
    const gameArea = document.getElementById('gameArea');
    const endScreen = document.getElementById('endScreen');
    const colPresente = document.getElementById('colPresente');
    const colPasado = document.getElementById('colPasado');
    const colParticipio = document.getElementById('colParticipio');
    const progressText = document.getElementById('progress');
    const feedbackText = document.getElementById('feedback');
    const nextRoundBtn = document.getElementById('nextRoundBtn');
    const restartBtn = document.getElementById('restartBtn');
    const exitBtn = document.getElementById('exitBtn');

    // --- UTILIDADES ---
    function shuffleArray(array) {
        return array.slice().sort(() => Math.random() - 0.5);
    }
    
    function updateProgress() {
        progressText.textContent = `Ronda ${currentRound} de 2 | Verbos completados: ${matchedCount}/${verbsPerRound}`;
    }
    
    function clearSelection() {
        selectedCards.forEach(card => {
            if (!card.classList.contains('matched')) {
                card.classList.remove('selected');
            }
        });
        selectedCards = [];
    }
    
    // --- LÓGICA DE JUEGO ---

    function startGame() {
        currentRound = 1;
        matchedCount = 0;
        gameArea.style.display = 'block';
        endScreen.style.display = 'none';
        nextRoundBtn.style.display = 'none';
        
        startRound();
    }

    function startRound() {
        matchedCount = 0;
        clearSelection();
        updateProgress();
        
        // 1. Determinar qué verbos usar
        const startIndex = (currentRound - 1) * verbsPerRound;
        const currentVerbs = VERBS_DATA.slice(startIndex, startIndex + verbsPerRound);

        // 2. Limpiar columnas
        colPresente.innerHTML = '<h2>Presente (Base Form)</h2>';
        colPasado.innerHTML = '<h2>Pasado (Past Simple)</h2>';
        colParticipio.innerHTML = '<h2>Pasado Participio (Past Participle)</h2>';

        // 3. Renderizar Tarjetas
        const shuffledPresente = shuffleArray(currentVerbs);
        const shuffledPasado = shuffleArray(currentVerbs);
        const shuffledParticipio = shuffleArray(currentVerbs);

        shuffledPresente.forEach(verb => createCard(verb.p, 'p', verb.id, colPresente));
        shuffledPasado.forEach(verb => createCard(verb.ps, 'ps', verb.id, colPasado));
        shuffledParticipio.forEach(verb => createCard(verb.pp, 'pp', verb.id, colParticipio));
        
        feedbackText.textContent = 'Haz clic en Presente, Pasado y Participio correctos para que se coloreen.';
        feedbackText.classList.remove('correct');
    }
    
    function createCard(text, form, id, container) {
        const card = document.createElement('div');
        card.textContent = text;
        card.className = 'verb-card';
        card.dataset.verbForm = form; // 'p', 'ps', 'pp'
        card.dataset.matchId = id;
        
        card.addEventListener('click', handleCardClick);
        container.appendChild(card);
    }

    // --- LÓGICA DE CLIC ---
    function handleCardClick(e) {
        const clickedCard = e.target;
        
        if (clickedCard.classList.contains('matched')) return; 

        // 1. Manejar selección:
        if (clickedCard.classList.contains('selected')) {
            // Deseleccionar si ya estaba seleccionada
            clickedCard.classList.remove('selected');
            selectedCards = selectedCards.filter(card => card !== clickedCard);
            feedbackText.textContent = 'Verbo deseleccionado. Continúa el emparejamiento.';
            return;
        }

        // 2. Comprobar que no se seleccione la misma forma 
        const form = clickedCard.dataset.verbForm;
        const formAlreadySelected = selectedCards.some(card => card.dataset.verbForm === form);
        
        if (formAlreadySelected) {
            feedbackText.textContent = `¡Error! Ya seleccionaste la forma ${form === 'p' ? 'Presente' : form === 'ps' ? 'Pasado' : 'Participio'}.`;
            return;
        }
        
        // 3. Añadir a la selección
        clickedCard.classList.add('selected');
        selectedCards.push(clickedCard);

        // 4. Evaluar el Match Triple
        if (selectedCards.length === 3) {
            
            const ids = new Set(selectedCards.map(card => card.dataset.matchId));
            const forms = new Set(selectedCards.map(card => card.dataset.verbForm));

            if (ids.size === 1 && forms.size === 3) {
                // ¡Match triple correcto!
                
                // Obtener el color único para este verbo (usamos el ID - 1 como índice)
                const matchId = parseInt(ids.values().next().value);
                const colorIndex = (matchId - 1) % COLOR_PALETTE.length; // Ciclo de colores
                const matchColor = COLOR_PALETTE[colorIndex];
                
                // Aplicar color y estado MATCHED a las tres tarjetas
                selectedCards.forEach(card => {
                    card.classList.remove('selected');
                    card.classList.add('matched');
                    card.style.backgroundColor = matchColor;
                    card.style.borderColor = matchColor;
                });

                matchedCount++;
                updateProgress();
                feedbackText.textContent = `¡Verbo Completo! ${matchedCount}/${verbsPerRound} completados.`;
                feedbackText.classList.add('correct');
                
                clearSelection(); 

                if (matchedCount === verbsPerRound) {
                    setTimeout(endRound, 1000);
                }
                
            } else {
                // Match triple incorrecto (IDs diferentes o formas repetidas)
                feedbackText.textContent = '¡Incorrecto! El Presente, Pasado y Participio deben coincidir en el mismo verbo. Intenta de nuevo.';
                feedbackText.classList.remove('correct');
                setTimeout(clearSelection, 800);
            }
        }
    }
    
    function endRound() {
        if (currentRound === 1) {
            currentRound++;
            nextRoundBtn.style.display = 'inline-block';
            feedbackText.textContent = '¡Ronda 1 completada! Haz clic en Continuar para la Ronda 2.';
        } else {
            // Fin del Juego (Ronda 2 terminada)
            gameArea.style.display = 'none';
            endScreen.style.display = 'block';
        }
    }

    // --- INICIALIZACIÓN Y EVENTOS ---
    nextRoundBtn.addEventListener('click', () => {
        nextRoundBtn.style.display = 'none';
        startRound();
    });
    
    restartBtn.addEventListener('click', startGame);
    
    exitBtn.addEventListener('click', () => {
        alert('Saliendo del juego. Puedes cerrar la ventana o regresar al curso de Moodle.');
        if (window.opener) {
            window.close();
        }
    });

    // Iniciar el juego al cargar
    window.onload = startGame;

</script>

</body>
</html>
